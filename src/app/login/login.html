<div class="min-h-screen flex items-center justify-center relative overflow-hidden bg-[#0B1120]">
  
  <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 brightness-100 contrast-150 mix-blend-overlay"></div>
  <div class="absolute -top-[20%] -left-[10%] w-[600px] h-[600px] bg-purple-600/30 rounded-full blur-[120px] animate-pulse"></div>
  <div class="absolute top-[40%] -right-[10%] w-[500px] h-[500px] bg-cyan-600/20 rounded-full blur-[100px] animate-bounce [animation-duration:6s]"></div>

  <div class="relative z-10 backdrop-blur-xl bg-slate-900/60 border border-white/10 rounded-3xl p-10 w-full max-w-md shadow-2xl
              shadow-black/50 ring-1 ring-white/10
              transform transition-all duration-500 hover:shadow-cyan-500/20 hover:border-cyan-500/30 group/card"
       [class.animate-shake]="hasError()">

    <div class="flex justify-center mb-8">
      <div class="relative flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-tr from-cyan-500/20 to-purple-500/20 border border-white/10 shadow-lg group-hover/card:scale-110 transition-transform duration-500">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-cyan-300 drop-shadow-[0_0_10px_rgba(103,232,249,0.8)]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
        </svg>
      </div>
    </div>

    @if (!isSetupMode()) {
    <div class="text-center mb-10">
      <h2 class="text-3xl font-bold text-white tracking-tight mb-2 drop-shadow-md">Secure Access</h2>
      <p class="text-slate-400 text-sm font-medium tracking-wide">Identity Verification Required</p>
    </div>

    <form (submit)="login($event)" class="space-y-8">
      
      <div class="relative group/input">
        <div class="relative overflow-hidden rounded-2xl">
          <input
            type="password"
            id="pin"
            inputmode="numeric"
            placeholder="••••"
            [field]="loginForm.pin"
            class="peer w-full bg-slate-950/50 border border-white/10 rounded-2xl px-6 py-6 text-center text-4xl font-mono
                   tracking-[0.8em] text-white placeholder-white/10
                   focus:outline-none focus:border-cyan-500/50 focus:bg-slate-900/80 focus:ring-1 focus:ring-cyan-500/50
                   transition-all duration-300 ease-out
                   hover:border-white/20 hover:bg-slate-900/60 shadow-inner shadow-black/50"
          />
          <div class="absolute top-0 left-0 w-full h-[2px] bg-gradient-to-r from-transparent via-cyan-400 to-transparent -translate-x-full peer-focus:animate-[scan_2s_ease-in-out_infinite]"></div>
        </div>
      </div>

      <button
        type="submit"
        [disabled]="loginForm.pin().invalid() || isLoading()"
        class="relative w-full group/button overflow-hidden rounded-xl p-[1px]
               disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 active:scale-[0.98]">
        
        <div class="absolute inset-0 bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 opacity-70 group-hover/button:opacity-100 animate-gradient-xy transition-opacity duration-300"></div>

        <div class="relative h-full bg-slate-900 rounded-[11px] group-hover/button:bg-slate-800 transition-colors duration-300">
          <div class="px-6 py-4 flex items-center justify-center space-x-2">
            <svg *ngIf="isLoading()" class="animate-spin -ml-1 mr-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span *ngIf="!isLoading()" class="font-bold text-white tracking-widest uppercase text-sm">Authenticate</span>
            <span *ngIf="isLoading()" class="font-bold text-white tracking-widest uppercase text-sm">Verifying...</span>
          </div>
        </div>
      </button>

      @if(loginForm.pin().invalid() && (loginForm.pin().dirty() || loginForm.pin().touched())) {
        <div class="bg-red-500/10 border border-red-500/20 rounded-lg p-3 animate-in fade-in slide-in-from-top-2 duration-300">
          
          @for(error of loginForm.pin().errors(); track $index) {
            <div class="flex items-center justify-center space-x-2 text-red-200 text-xs text-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
              </svg>
              <span>{{ error.message }}</span>
            </div>
          }

        </div>
      }
    </form>
    }     @else {
    <div class="text-center mb-10">
      <h2 class="text-3xl font-bold text-white tracking-tight mb-2 drop-shadow-md">Initial Setup</h2>
      <p class="text-slate-400 text-sm font-medium tracking-wide">Register First Dispatcher</p>
    </div>

    <form (submit)="register($event)" class="space-y-6">
      
      <div class="relative group/input">
        <div class="relative overflow-hidden rounded-2xl">
          <input
            type="text"
            id="name"
            placeholder="Enter Name"
            [field]="registrationForm.name"
            class="peer w-full bg-slate-950/50 border border-white/10 rounded-2xl px-6 py-4 text-center text-lg font-mono
                   tracking-wide text-white placeholder:text-base placeholder:tracking-normal placeholder:font-sans placeholder-white/20
                   focus:outline-none focus:border-cyan-500/50 focus:bg-slate-900/80 focus:ring-1 focus:ring-cyan-500/50
                   transition-all duration-300 ease-out
                   hover:border-white/20 hover:bg-slate-900/60 shadow-inner shadow-black/50"
          />
          <div class="absolute top-0 left-0 w-full h-[2px] bg-gradient-to-r from-transparent via-cyan-400 to-transparent -translate-x-full peer-focus:animate-[scan_2s_ease-in-out_infinite]"></div>
        </div>
      </div>

      <div class="relative group/input">
        <div class="relative overflow-hidden rounded-2xl">
          <input
            type="password"
            id="reg-pin"
            inputmode="numeric"
            placeholder="Create PIN (4 digits)"
            [field]="registrationForm.pin"
            class="peer w-full bg-slate-950/50 border border-white/10 rounded-2xl px-6 py-4 text-center text-4xl font-mono
                   tracking-[0.8em] text-white placeholder:text-sm placeholder:tracking-normal placeholder:font-sans placeholder-white/20
                   focus:outline-none focus:border-cyan-500/50 focus:bg-slate-900/80 focus:ring-1 focus:ring-cyan-500/50
                   transition-all duration-300 ease-out
                   hover:border-white/20 hover:bg-slate-900/60 shadow-inner shadow-black/50"
          />
          <div class="absolute top-0 left-0 w-full h-[2px] bg-gradient-to-r from-transparent via-cyan-400 to-transparent -translate-x-full peer-focus:animate-[scan_2s_ease-in-out_infinite]"></div>
        </div>
      </div>

      <button
        type="submit"
        [disabled]="registrationForm().invalid() || isLoading()"
        class="relative w-full group/button overflow-hidden rounded-xl p-[1px]
               disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 active:scale-[0.98]">
        
        <div class="absolute inset-0 bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 opacity-70 group-hover/button:opacity-100 animate-gradient-xy transition-opacity duration-300"></div>

        <div class="relative h-full bg-slate-900 rounded-[11px] group-hover/button:bg-slate-800 transition-colors duration-300">
          <div class="px-6 py-4 flex items-center justify-center space-x-2">
            @if (isLoading()) {
              <svg class="animate-spin -ml-1 mr-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              <span class="font-bold text-white tracking-widest uppercase text-sm">Registering...</span>
            } @else {
              <span class="font-bold text-white tracking-widest uppercase text-sm">Register Dispatcher</span>
            }
          </div>
        </div>
      </button>

      @if(registrationForm.name().invalid() && (registrationForm.name().dirty() || registrationForm.name().touched()) || 
          registrationForm.pin().invalid() && (registrationForm.pin().dirty() || registrationForm.pin().touched())) {
        <div class="bg-red-500/10 border border-red-500/20 rounded-lg p-4 animate-in fade-in slide-in-from-top-2 duration-300 space-y-2">
          
          @for(error of registrationForm.name().errors(); track $index) {
            <div class="flex items-center justify-center space-x-2 text-red-200 text-xs text-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
              </svg>
              <span class="font-medium">Name: {{ error.message }}</span>
            </div>
          }

          @for(error of registrationForm.pin().errors(); track $index) {
            <div class="flex items-center justify-center space-x-2 text-red-200 text-xs text-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
              </svg>
              <span class="font-medium">PIN: {{ error.message }}</span>
            </div>
          }

        </div>
      }
    </form>
    }

    <div class="text-center mt-10">
      <div class="inline-flex items-center space-x-2 opacity-30">
        <div class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></div>
        <p class="text-white text-[10px] font-mono uppercase tracking-[0.2em]">System Secure • v2.1.0</p>
      </div>
    </div>

  </div> @if (toast()) {
    <div class="fixed bottom-8 left-0 right-0 mx-auto w-fit z-50 animate-in fade-in duration-300 px-4">
      
      <div class="flex items-center space-x-4 px-6 py-4 rounded-xl border backdrop-blur-md shadow-2xl min-w-[300px] max-w-md bg-slate-900/90 border-white/10"
           [class.border-green-500/30]="toast()?.type === 'success'"
           [class.bg-green-900/80]="toast()?.type === 'success'"
           [class.border-red-500/30]="toast()?.type === 'error'"
           [class.bg-red-900/80]="toast()?.type === 'error'">
        
        <div *ngIf="toast()?.type === 'success'" class="flex-shrink-0 w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center">
          <svg class="w-6 h-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
          </svg>
        </div>
  
        <div *ngIf="toast()?.type === 'error'" class="flex-shrink-0 w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center">
          <svg class="w-6 h-6 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </div>
  
        <div class="flex-1">
          <h4 class="text-sm font-bold text-white uppercase tracking-wider"
              [class.text-green-400]="toast()?.type === 'success'"
              [class.text-red-400]="toast()?.type === 'error'">
            {{ toast()?.type === 'success' ? 'System Unlocked' : 'Access Denied' }}
          </h4>
          <p class="text-xs text-white/70 mt-0.5">{{ toast()?.message }}</p>
        </div>
  
        <button (click)="hideToast()" class="text-white/40 hover:text-white transition-colors">
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
    </div>
  }

</div>